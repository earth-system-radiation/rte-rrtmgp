name: Check Fortran API
on:
  push:
    branches:
    - main
    - develop
  pull_request:
    branches-ignore:
    - documentation
  workflow_dispatch:


jobs:
  API:
    runs-on: ubuntu-22.04
    env:
      # Core variables:
      FC: gfortran-12
      FCFLAGS: "-ffree-line-length-none -m64 -std=f2008 -march=native -fbounds-check -fmodule-private -fimplicit-none -finit-real=nan -g"
      RRTMGP_ROOT: ${{ github.workspace }}
      RTE_KERNELS: extern
      RTE_CBOOL: ON
      RRTMGP_DATA_VERSION: v1.8.2
    steps:
    #
    # Check out repository under $GITHUB_WORKSPACE
    #
    - name: Check out code
      uses: actions/checkout@v4
    #
    # Build libraries
    #
    - name: Build libraries
      run: |
        $FC --version
        cmake -S . -B build \
            -DCMAKE_Fortran_COMPILER=$FC \
            -DCMAKE_Fortran_FLAGS="$FCFLAGS" \
            -DRRTMGP_DATA_VERSION=$RRTMGP_DATA_VERSION \
            -DUSE_C_BOOL=$RTE_CBOOL \
            -DKERNEL_MODE=$RTE_KERNELS
        cmake --build build --config Release -- -j8
