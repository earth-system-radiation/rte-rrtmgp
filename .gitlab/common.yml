.dp:
  variables:
    FPMODEL: DP
    FAILURE_THRESHOLD: "7.e-4"

.sp:
  variables:
    FPMODEL: SP
    FAILURE_THRESHOLD: "3.5e-1"

.common:
  variables:
    # Make variables:
    MAKEFLAGS: -j8
    RRTMGP_ROOT: ${CI_PROJECT_DIR}
    RRTMGP_DATA_TAG: v1.8.2
  script:
    #
    # Build libraries, examples and tests
    #
    - name: Build libraries and tests
      run: |
        - $FC --version
        - cmake -S . -B build \
            -DCMAKE_Fortran_COMPILER=$FC \
            -DCMAKE_Fortran_FLAGS="$FCFLAGS" \
            -DRRTMGP_DATA_VERSION=$RRTMGP_DATA_TAG \
            -DPRECISION=$FPMODEL \
            -DBOOL_TYPE=$RTE_BOOL \
            -DKERNEL_MODE=$RTE_KERNELS \
            -DENABLE_TESTS=ON \
            -DFAILURE_THRESHOLD=$FAILURE_THRESHOLD
        - cmake --build build --config Release -- -j8
    #
    # Run examples, tests and checks
    #
    - name: Run examples, tests and checks
      run: |
        ctest -V --test-dir build
